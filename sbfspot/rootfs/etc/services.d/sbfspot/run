#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start the SBFspot service
# s6-overlay docs: https://github.com/just-containers/s6-overlay
# ==============================================================================

set -e

echo 'Show all runlevels and their services.'
rc-status -a

echo 'Show all services.'
rc-status -s

# --- GENERATE CONFIG --
echo "PWD is current directory $(pwd)"
cd /
echo "PWD is current directory $(pwd)"
./generateConfig.sh SBFspot.cfg SBFspotUpload.cfg

#chmod a+x SBFspot.cfg SBFspotUpload.cfg

# ---- RUN ----
# start service
echo 'Starting daemon'
rc-service SBFspotUploadDaemon.service start

# cron
echo 'Starting cron in foreground'
/usr/sbin/crond -f

# add logging to HA logs, this is a hard coded directory, which also doesn't get deleted if in /data...
echo 'Showing Logs in HA'
tail -fn1 /data/sbfspot/log/* > /dev/stdout

# echo 'Starting daemon'
# ./SBFspotUploadDaemon
