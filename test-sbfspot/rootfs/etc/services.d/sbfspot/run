#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start the SBFspot service
# s6-overlay docs: https://github.com/just-containers/s6-overlay
# ==============================================================================

CONFIG_PATH=/data/options.json


# --- GENERATE CONFIG --
echo "PWD is current directory $(pwd)"
cd / 

echo "PWD is current directory $(pwd)"

if bashio::config.connection_type "Bluetooth"; then
   bashio::log.info "Setting Connection to Bluetooth"
   /usr/bin/sbfspot/genBluetoothConfig.sh /usr/bin/sbfspot/SBFspot.cfg /usr/bin/sbfspot/SBFspotUpload.cfg
 else 
   bashio::log.error "Bluetooth Config not set"
fi

if bashio::config.connection_type "Ethernet"; then
   bashio::log.warning "Ethernet being setup"
   /usr/bin/sbfspot/genEthernetConfig.sh /usr/bin/sbfspot/SBFspot.cfg /usr/bin/sbfspot/SBFspotUpload.cfg
fi

# ---- Print Host BT Controller and sys info
echo "$(uname -smrv)"
## Get the 'message' key from the user config options.
message=$(echo "[Host Bluetooth MAC Address] $(bluetoothctl list)")


## Print the message the user supplied, defaults to "Hello World..."
bashio::log.info "${message:="Hello World..."}"

# ---- RUN ----

echo 'Starting daemon'


# cron
echo 'Starting cron in foreground'
exec /usr/sbin/crond -f
